// test micro-manager file loading - had an issue where E: freezes up after loading too many stacks in a row?

import java.util.Date;
import java.text.DateFormat;
import java.text.SimpleDateFormat;

import org.micromanager.PositionList;
import org.micromanager.data.Image;
import org.micromanager.internal.utils.MMException;

import ij.process.ImageProcessor;
import ij.ImageStack;
import ij.ImagePlus;
import ij.IJ;

mmc = mm.getCMMCore();
sc = mm.getScriptController();

savedir = "E:/stress_test/attempt2_long_close2/";
volume_dir = "E:/nina/20220714_live_plate3/main_live6/22-07-25/02-09-44/";

n_pos = 170;
repeats = 100;
index = 0;
wavelength = 561;
fw = 2;

new File(savedir).mkdir();
BufferedWriter log
	= new BufferedWriter(new FileWriter(savedir + "mmgr_openfile_log.csv"));

for(i = 0; i < repeats; i++){
	for(f = 0; f < n_pos; f++) {  // fields
		print("Field "+ f);
	
		end_dir = "run_" + index + "/field_" + f + "/" + wavelength + "/" + fw + "/acq_rfl/MMStack.ome.tif";
		load_dir = volume_dir + end_dir;
		print("opening: " + load_dir);

		time_begin = new Date().getTime();
		imp = IJ.openImage(load_dir);
		// imp.close();
		time_end = new Date().getTime();
		log.write(i + "," + f + "," + (time_end - time_begin) + "\n");
		log.flush();
		Thread.sleep(1000);
		imp.close();
	}
	Thread.sleep(1000*60*10);
}
log.close();